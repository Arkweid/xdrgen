// Automatically generated from #{@output.source_path}
// DO NOT EDIT or your changes may be overwritten

package <%= @namespace || "main" %>

import (
  "errors"
  "fmt"
  "github.com/davecgh/go-xdr/xdr2"
)

// Primitive decoders
<% PRIMITIVES.each do |xdr, go| %>

func Decode<%=xdr%>(decoder *xdr.Decoder, result *<%=go%>) (int, error) {
  val, bytesRead, err := decoder.Decode<%=xdr%>()

  if err == nil {
    *result = val
  }

  return bytesRead, err
}

func DecodeOptional<%=xdr%>(decoder *xdr.Decoder, result **<%=go%>) (int, error) {
  
  isPresent, presenceBytesRead, err := decoder.DecodeBool()

  if err != nil {
    return presenceBytesRead, err
  }

  if !isPresent {
    return presenceBytesRead, err
  }

  val, bytesRead, err := decoder.Decode<%=xdr%>()

  if err == nil {
    *result = &val
  }

  return bytesRead + presenceBytesRead, err
}

func Decode<%=xdr%>Array(decoder *xdr.Decoder, result []<%=go%>, size int) (int, error) {
  var (
    totalRead int
    bytesRead int
    err       error
  )

  if len(result) != size {
    errMsg := fmt.Sprintf("xdr: bad array len:%d, expected %d", len(result), size)
    return 0, errors.New(errMsg)
  }

  for i := 0; i < size; i++ {
    bytesRead, err = Decode<%=xdr%>(decoder, &result[i])

    if err != nil {
      return totalRead, err
    }

    totalRead += bytesRead
  }

  return totalRead, nil
}


func Decode<%=xdr%>VarArray(decoder *xdr.Decoder, result *[]<%=go%>, maxSize int32) (int, error) {
  var (
    size      int32
    totalRead int
    bytesRead int
    err       error
  )

  bytesRead, err = DecodeInt(decoder, &size)
  totalRead += bytesRead

  if err != nil {
    return totalRead, err
  }

  if size > maxSize {
    errMsg := fmt.Sprintf("xdr: encoded size too large:%d, max:%d", size, maxSize)
    return totalRead, errors.New(errMsg)
  }

  var theResult = make([]<%=go%>, size)
  *result = theResult

  for i := int32(0); i < size; i++ {
    bytesRead, err = Decode<%=xdr%>(decoder, &theResult[i])

    if err != nil {
      return totalRead, err
    }

    totalRead += bytesRead
  }

  return totalRead, nil
}

<% end %>